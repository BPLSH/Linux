<chapter 7>
===========
  
# 파일 시스템과 디스크 관리 #  
  
파일 시스템은 운영체제의 주요한 기능으로 다양한 정보를 가지는 파일과 디렉터리를 구조적으로 관리하는 체계  
다양한 파일 시스템 형식을 사용하고 있다.  
  
## 1. 리눅스 파일 시스템의 종류 ##    
### 리눅스 고유의 디스크 기반 파일 시스템 ###  
**ext1**  
레미 카드가 개발  
MFS의 기능을 확장  
- 16bit 주소 체계를 사용  
- 파일 시스템의 최대 크기 : 64MB->2GB  
- 파일 이름의 길이 : 14B->25B  
- inode의 수정과 데이터의 수정 시간 지원이 안되는 문제  
- 링크드 리스트로 파일 시스템을 구성하여 파일 시스템이 복잡해지고 파편화되는 문제  
  
**ext2**  
레미 카드가 개발  
ext1 파일 시스템을 기반으로 함  
- 파일 시스템의 최대 크기 : 2TB->32TB  
- 부팅 가능한 USB 플래시 드라이브와 기타 SSD 장치에 사용됨  
  
**ext3**  
스티븐 트위디가 개발  
ext2 파일 시스템을 기반으로 함  
ext2 파일 시스템의 파일을 ext3 파일 시스템에 바로 이식 가능  
- 저널링 기능 : 저널링은 데이터를 디스크에 기록하기 전에 저널에 기록함으로써 오류가 발생할 경우, 이러한 저널에 기록된 로그를 보고 복구 할수 있다.  
- inode의 동적할당이나 다양한 블록 크기와 같은 최신 파일 시스템 기능이 부족  
- 온라인 조각모음 기능의 부재  
- 파일 시스템의 최대 크기 : 32TB
  
**ext4**  
- 파일 시스템의 최대 크기 : 1EB(1024*1024TB)  
- 16TB 이상의 파일 지원  
- ext2와 ext3와 호환성을 가짐  
- 서브 디렉터리의 수 : 3200 -> 6400  
- 온라인 조각 모음 기능을 가짐  
  
**XFS**  
- 64bit 파일 시스템  
- 파일 시스템의 최대 크기 : 16EB  
- xfsprogs 패키지가 설치되어야 함  
  
### 리눅스에서 지원하는 기타 디스크 기반 파일 시스템 ###  
* msdos : MS-DOS 파티션을 사용하기 위한 파일 시스템  
* iso9660 : CD-ROM, DVD의 읽기 전용 표준 파일 시스템  
* nfs : network file system으로 원격 서버의 디스크를 연결할때 사용  
* ufs : 유닉스 파일 시스템으로 유닉스의 표준 파일 시스템이다.  
* vfat : 윈도 95, 98, NT를 지원하기 위한 파일 시스템  
* hpfs : HPFS를 지원하기 위한 파일 시스템  
* ntfs : 윈도의 NTFS를 지원하기 위한 파일 시스템  
* sysv : 유닉스 시스템V를 지원하기 위한 파일 시스템  
* hfs : 맥 컴퓨터의 hfs 파일 시스템을 지원하기 위한 파일 시스템  
  
### 특수 용도의 가상 파일 시스템 ###  
메모리에서 생성되어 사용되는 가상 파일 시스템이다. 일반적으로 특수한 용도로 필요에 따라 생겼다 없어졌다 한다.  
* swap : 스왑 영역을 관리하기 위한 **스왑 파일 시스템**이다. 우분투에서는 스왑 파일 시스템 대신 스왑 파일을 사용한다.  
* tmpfs : 메모리에 임시 파일을 저장하기 위한 **임시 파일 시스템**이다. 시스템이 재시작할 때 마다 내용이 사라진다. ex) /run 디렉터리  
* proc :  **proc 파일 시스템**으로 커널의 현재 상태를 나타낸다. ex) /proc 디렉터리  
* ramfs : **램디스크를 지원하는 파일 시스템**  
* rootfs : 시스템 초기화 및 관리에 필요한 내용을 관리하는 **루트 파일 시스템** ex) / 디렉터리  
  
### 현재 시스템이 지원하는 파일 시스템 확인 ###  
cat /proc/filesystems는 현재 커널이 지원하는 파일 시스템의 종류를 알려준다.  
  
### 리눅스 파일 시스템의 구조 ###  
1. 파일은 inode로 관리된다.  
2. 디렉터리는 단순히 파일의 목록을 가지는 파일이다.  
3. 특수파일을 통해 장치에 접근할 수 있다.  
  
## 2. 리눅스 파일 시스템의 구조 ##  
  
### ext4 파일 시스템의 구조 ###  
ext4 파일 시스템은 효율적인 디스크 관리를 위해 저장 장치를 논리적인 블록의 집합으로 구분한다.  
블록의 개수는 장치의 크기를 블록 그룹의 크기로 나눈 값이다.  
블록 그룹 0 : 파일 시스템의 첫번째 블록 그룹으로 특별하게 그룹 0 패딩과 슈퍼블록, 그룹 디스크립터를 가짐  
블록 그룹 a : 파일 시스템에서 그룹 0 패딩이 없고 슈퍼블록, 그룹 디스크립터의 복사본을 가짐  
블록 그룹 b : 파일 시스템엥서 그룹 0 패딩과 슈퍼블록, 그룹 디스크립터가 없고 바로 데이터 블록 비트맵으로 시작한다.  
**그룹 0 패딩**  
블록 그룹 0의 첫 1024B는 부트 섹터와 부가 정보를 저장  
**슈퍼 블록**  
파일 시스템과 관련된 다양한 정보가 저장  
**그룹 디스크립터**  
**데이터 블록 비트맵**  
**inode 비트맵**  
**inode 테이블과 데이터 블록**  
  
### inode의 구조 ###  
파일 정보를 저장하는 부분과 실제 파일 내용이 저장되어 있는 데이터 블록의 주소  
데이터 블록은 직접 블록, 간접 블록, 이중 간접 블록으로 구분된다.  
**직접 블록** : 데이터 블록에 대한 주소를 직접 가지고 있다.  
**간접 블록, 이중 간접 블록** : 데이터 블록에 대한 주소를 가지고 있는 블록에 대한 주소를 가진다.  
  
### 파일 시스템과 디렉터리 계층 구조 ###  
**한 파일 시스템으로 구성하기**  
/ 디렉터리에 파일 시스템을 연결한다.  
**여러 파일 시스템으로 구성하기**  
여러 파일 시스템으로 나누어 디렉터리 계층 구조를 구성할 경우, 일부 파일 시스템에 문제가 생기더라도 다른 파일 시스템은 안전하다.  
  
## 3. 파일 시스템 마운트 ##  
**마운트 포인트**  
파일 시스템이 디렉터리 계층 구조와 연결되지 않으면 사용자는 해당 파일 시스템에 접근할 수 없다.  
따라서 파일 시스템을 계층 구조의 특정 디렉터리와 연결하는 것을 마운트라고 한다.  
디렉터리 계층 구조에서 파일 시스템이 연결되는 디렉터리를 마운트 포인트라고 한다.  
/디렉터리도 마운트 포인트이다.  
  
**파일 시스템 마운트 설정 파일**  
이동식 저장 장치를 제외하곤 대부분의 파일 시스템은 부팅할 때 마운트된다.  
자동으로 마운트되게 하려면 /etc/fstab 파일에 설정한다.  
  
**/etc/fstab 파일의 기능**
/etc/fstab 파일은 파일 시스템의 마운트 설정 정보를 가지고 있다.  
  
**/etc/fstab 파일의 구조**  
장치명 - 마운트 포인트 - 파일 시스템의 종류 - 옵션 - 덤프 관련 설정 - 파일 점검 옵션  
파일 점검 옵션에서 0으로 지정된 파일 시스템은 fsck 명령(파일 시스템 점검)을 실행하지 않으며,  
1은 루트 파일 시스템으로 부팅할 때 fsck 명령으로 파일 시스템 점검을 수행하고,  
2는 나열된 순서대로 부팅할 때 fsck 명령으로 파일 시스템 점검을 한다.  
**UUID** : 로컬 시스템과 다른 시스템에서 파일 시스템을 구분해주는 128비트 숫자. 디스크가 추가될 때 부트로더를 가지고 있는  
부트 장치의 이름이 바뀌는 것을 방지하기 위해 사용된다.  
 
### 마운트 관련 명령어 ###  
**mount** : 파일 시스템을 마운트하는 명령어  
- t 파일 시스템 종류 : 파일 시스템 종류를 지정한다.  
- o 마운트 옵션 : 마운트 옵션을 지정한다.  
- f : 마운트 할수 있는지 점검만 한다.  
- r : 읽기만 가능하게 마운트한다.  
  
/etc/mtab의 현재 마운트되어 있는 정보가 출력된다.  

**unmount** : 파일 시스템을 언마운트한다.  
- t 파일 스템 종류 : 파일 시스템 종류를 지정한다.  
  
## 4. 디스크 추가 설치 ##  
하드디스크를 추가로 장착  
**디스크 추가 단계**  
새 디스크 장착 - 디스크 파티션 나누기 - 파티션에 파일 시스템 생성 - 디스크 마운트  
  
### 가상 머신에 디스크 추가하기 ###  
IDE 디스크 컨트롤러 2개, SATA 컨트롤러 2개, SCSI 디스크 컨트롤러 네 개로 구성되어있다.  pg366  
SCSI 방식은 서버급 장치에서 자주 사용된다.  
현재 디스크는 SCSI 0번 컨트롤러의 첫번째 슬롯(SCSI 0:0)에 연결되어 있고 CD-ROM 장치는 SATA에 연결되어 있다.  
  
### 디스크 파티션 나누기 ###  
가상머신 컨트롤러의 디스크가 추가되었으면 파티션을 나눈다. 파티션이란 하나의 디스크를 독립된 영역으로 구분하는 것으로, 디스크 전체를  
하나의 파티션으로 사용할 수도 있고 여러 개의 파티션으로 나누어 사용할 수 있다. 윈도의 C드라이브와 D드라이브와 같음  
  
**디스크 장치의 이름**  
IDE 컨트롤러에 연결된 디스크는 /dev/hd로 시작하는 이름을, SCSI나 SATA 컨트롤러에 장착된 디스크는 /dev/sd로 시작하는 이름을 가졌으나  
최근에는 /dev/sd로 통합하였다. 컨트롤러에 연결되는 디스크의 순서에 따라 알파벳이 추가된다.  
/dev/sda: 첫번째 디스크  
/dev/sdb: 두번째 디스크  
/dev/sdc: 세번째 디스크  
IDE 컨트롤러에 장착된 디스크가 SCSI에 장착된 디스크보다 앞에 배정된다.  
  
**디스크 장치의 이름과 파티션 표시하기**  
파티션은 디스크 장치명의 뒤에 숫자를 붙여서 표시한다.  
/dev/sda : 첫번째 디스크 전체를 의미하는 장치명  
/dev/sda1 : 첫번째 디스크의 첫번째 파티션  
/dev/sda2 : 첫번째 디스크의 두번째 파티션  
  
**fdisk 명령**  
디스크를 파티션으로 나누는 명령어  
- b 크기 : 섹터 크기를 지정한다.  
- l : 파티션 테이블을 출력한다.  
